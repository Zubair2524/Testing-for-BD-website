<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pharmaceutical Database - Live Dashboard</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(180deg, #0a1929 0%, #1a2332 100%);
            background-attachment: fixed;
            min-height: 100vh;
            padding: 20px;
            color: #e3f2fd;
        }

        .container { max-width: 1800px; margin: 0 auto; }

        /* Header */
        .header { text-align: center; margin-bottom: 30px; animation: fadeInDown 0.6s ease; }
        @keyframes fadeInDown { from { opacity: 0; transform: translateY(-20px); } to { opacity: 1; transform: translateY(0); } }
        .header h1 { color: #ffffff; font-size: 2.5em; text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5); margin-bottom: 10px; }
        .feature-badge { background: linear-gradient(135deg, #43a047 0%, #66bb6a 100%); color: white; padding: 6px 15px; border-radius: 20px; font-size: 0.85em; font-weight: 700; margin: 5px; display: inline-block; }

        /* Glass Card & Search */
        .glass-card { background: rgba(255, 255, 255, 0.08); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.15); border-radius: 16px; padding: 25px; margin-bottom: 25px; }
        .search-container { position: relative; }
        .search-input { width: 100%; padding: 16px; border-radius: 12px; background: white; color: #0a1929; border: none; font-size: 1.1em; }
        
        /* Stats Grid */
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 15px; margin-bottom: 25px; }
        .stat-card { background: rgba(25, 118, 210, 0.15); border: 2px solid rgba(100, 181, 246, 0.3); border-radius: 14px; padding: 18px; text-align: center; }
        .stat-number { font-size: 2.2em; font-weight: 700; color: #ffffff; }
        .stat-label { font-size: 0.8em; color: #b0bec5; text-transform: uppercase; }

        /* Results Grid */
        .results-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(400px, 1fr)); gap: 20px; }
        .product-card { background: rgba(255, 255, 255, 0.08); border: 2px solid rgba(100, 181, 246, 0.2); border-radius: 14px; padding: 20px; transition: 0.3s; }
        .product-card:hover { transform: translateY(-5px); border-color: #64b5f6; }
        .card-header { border-bottom: 2px solid rgba(100, 181, 246, 0.3); padding-bottom: 12px; margin-bottom: 15px; }
        .product-name { font-size: 1.2em; font-weight: 700; color: #ffffff; }
        .info-label { font-size: 0.7em; color: #90caf9; text-transform: uppercase; margin-top: 10px; font-weight: bold; }
        .info-value { font-size: 0.95em; line-height: 1.4; margin-bottom: 10px; }

        /* Buttons */
        .research-links { display: flex; gap: 10px; margin-top: 15px; }
        .btn { flex: 1; padding: 10px; border-radius: 8px; text-align: center; text-decoration: none; font-weight: 600; cursor: pointer; border: none; font-size: 0.9em; }
        .btn-google { background: #4285f4; color: white; }
        .btn-edit { background: #1976d2; color: white; }
        .load-more-btn { background: #1976d2; color: white; padding: 15px 40px; border-radius: 30px; border: none; cursor: pointer; display: block; margin: 20px auto; }

        /* Edit Modal */
        .edit-modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); z-index: 9999; align-items: center; justify-content: center; }
        .edit-modal.show { display: flex; }
        .edit-modal-content { background: #1e3a5f; padding: 30px; border-radius: 16px; width: 90%; max-width: 600px; color: white; }
        .edit-form-group { margin-bottom: 15px; }
        .edit-form-group label { display: block; margin-bottom: 5px; color: #90caf9; }
        .edit-form-group input, textarea { width: 100%; padding: 10px; border-radius: 5px; border: 1px solid #42a5f5; background: #0a1929; color: white; }
        .save-btn { width: 100%; padding: 15px; background: #43a047; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; }
        
        .loading { text-align: center; padding: 50px; font-size: 1.5em; }
    </style>
</head>
<body>

<div class="container">
    <div class="header">
        <h1>ðŸ§¬ Business Development Portal - Shaigan Pharma</h1>
        <p>Live Dashboard - Connected to Testing Sheet for BD</p>
        <div class="feature-badges">
            <span class="feature-badge">LIVE SYNC</span>
            <span class="feature-badge">RECORDS: <span id="syncCount">...</span></span>
        </div>
    </div>

    <div class="glass-card">
        <div class="search-container">
            <input type="text" class="search-input" id="searchInput" placeholder="Search by Product Name, Composition, or Indication...">
        </div>
    </div>

    <div class="stats-grid">
        <div class="stat-card">
            <div class="stat-number" id="statTotal">0</div>
            <div class="stat-label">Total Products</div>
        </div>
        <div class="stat-card">
            <div class="stat-number" id="statFiltered">0</div>
            <div class="stat-label">Matching</div>
        </div>
    </div>

    <div id="resultsGrid" class="results-grid">
        <div class="loading">Initializing Database...</div>
    </div>

    <button id="loadMoreBtn" class="load-more-btn" style="display:none;" onclick="loadMore()">Load More Records</button>
</div>

<div class="edit-modal" id="editModal">
    <div class="edit-modal-content">
        <h2>Update Product Info</h2>
        <p id="editMsg" style="color: #4caf50; margin-bottom: 10px;"></p>
        <div class="edit-form-group">
            <label>Product Name (ID)</label>
            <input type="text" id="editName" readonly style="opacity: 0.6;">
        </div>
        <div class="edit-form-group">
            <label>Composition</label>
            <input type="text" id="editComp">
        </div>
        <div class="edit-form-group">
            <label>MAT Value</label>
            <input type="text" id="editMAT">
        </div>
        <div class="edit-form-group">
            <label>Indication</label>
            <textarea id="editInd" rows="3"></textarea>
        </div>
        <button class="save-btn" onclick="saveData()">ðŸš€ Sync to Google Sheet</button>
        <button class="btn" style="background:none; color:white; margin-top:10px; width:100%;" onclick="closeModal()">Cancel</button>
    </div>
</div>

<script>
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwm2u27sZNPQqyS5CV_-T3vYHrm0mC2du22Zk68sKKtozp-FLFFzXZKBItDxrPzwZdYiQ/exec";
    let db = [];
    let filtered = [];
    let limit = 20;

    // 1. Fetch Data from Sheet
    async function loadData() {
        try {
            const response = await fetch(SCRIPT_URL);
            db = await response.json();
            filtered = [...db];
            updateUI();
        } catch (e) {
            document.getElementById('resultsGrid').innerHTML = "Error connecting to Sheet. Check Web App permissions.";
        }
    }

    // 2. Render Cards
    function updateUI() {
        const grid = document.getElementById('resultsGrid');
        const show = filtered.slice(0, limit);
        
        document.getElementById('statTotal').innerText = db.length;
        document.getElementById('statFiltered').innerText = filtered.length;
        document.getElementById('syncCount').innerText = db.length;

        if (show.length === 0) {
            grid.innerHTML = "<div class='loading'>No records found.</div>";
            return;
        }

        grid.innerHTML = show.map(item => `
            <div class="product-card">
                <div class="card-header">
                    <div class="product-name">${item.ProductName}</div>
                    <div style="font-size: 0.8em; color: #b0bec5;">Code: ${item.ProductCode || 'N/A'}</div>
                </div>
                <div class="info-label">ðŸ§¬ Composition</div>
                <div class="info-value">${item.Composition}</div>
                <div class="info-label">ðŸ“Š MAT Value</div>
                <div class="info-value" style="color: #ffc107; font-weight: bold;">${item.MATValue || 'N/A'}</div>
                <div class="info-label">ðŸ©º Indication</div>
                <div class="info-value">${item.Indication || 'No data'}</div>
                
                <div class="research-links">
                    <a href="https://www.google.com/search?q=${item.ProductName}+pharmaceuticals" target="_blank" class="btn btn-google">Google</a>
                    <button class="btn btn-edit" onclick="openModal('${item.ProductName.replace(/'/g, "\\'")}')">Edit</button>
                </div>
            </div>
        `).join('');

        document.getElementById('loadMoreBtn').style.display = filtered.length > limit ? 'block' : 'none';
    }

    // 3. Search Logic
    document.getElementById('searchInput').addEventListener('input', (e) => {
        const term = e.target.value.toLowerCase();
        filtered = db.filter(i => 
            i.ProductName.toLowerCase().includes(term) || 
            i.Composition.toLowerCase().includes(term) ||
            (i.Indication && i.Indication.toLowerCase().includes(term))
        );
        limit = 20;
        updateUI();
    });

    // 4. Modal Logic
    function openModal(name) {
        const item = db.find(p => p.ProductName === name);
        document.getElementById('editName').value = item.ProductName;
        document.getElementById('editComp').value = item.Composition;
        document.getElementById('editMAT').value = item.MATValue || '';
        document.getElementById('editInd').value = item.Indication || '';
        document.getElementById('editModal').classList.add('show');
    }

    function closeModal() { document.getElementById('editModal').classList.remove('show'); }

    async function saveData() {
        const btn = document.querySelector('.save-btn');
        btn.innerText = "â³ Syncing...";
        btn.disabled = true;

        const data = {
            ProductName: document.getElementById('editName').value,
            Composition: document.getElementById('editComp').value,
            MATValue: document.getElementById('editMAT').value,
            Indication: document.getElementById('editInd').value
        };

        await fetch(SCRIPT_URL, {
            method: 'POST',
            mode: 'no-cors',
            body: JSON.stringify(data)
        });

        document.getElementById('editMsg').innerText = "Update sent to Sheet! Reloading...";
        setTimeout(() => {
            location.reload();
        }, 1500);
    }

    function loadMore() { limit += 20; updateUI(); }

    window.onload = loadData;
</script>
</body>
</html>
